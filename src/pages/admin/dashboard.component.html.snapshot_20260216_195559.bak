
    <div class="min-h-screen bg-gray-50 dark:bg-gray-900 flex font-sans transition-colors duration-300">
      
      <!-- Mobile Sidebar Overlay -->
      @if (mobileMenuOpen) {
        <div class="fixed inset-0 bg-black/60 z-[90] md:hidden backdrop-blur-sm transition-opacity" (click)="mobileMenuOpen = false"></div>
      }

      <!-- Sidebar -->
      <aside class="w-72 bg-white dark:bg-brand-darksurface border-r border-gray-200 dark:border-gray-700 flex flex-col fixed inset-y-0 z-[100] shadow-2xl transform transition-transform duration-300 md:translate-x-0"
             [class.translate-x-0]="mobileMenuOpen"
             [class.-translate-x-full]="!mobileMenuOpen">
        
        <div class="p-8 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between gap-3">
          <div class="flex items-center gap-3">
            @if (store.institutional().logoUrl) {
                <img [src]="store.institutional().logoUrl" class="h-8 w-auto object-contain">
            } @else {
                <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-lg border border-gray-100">
                  <app-icon name="rainbow" size="24px"></app-icon>
                </div>
            }
            <div>
              <h1 class="text-xl font-black text-brand-dark dark:text-white tracking-tight">YARA<span class="text-brand-pink">Admin</span></h1>
              <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Painel v4.3</p>
            </div>
          </div>
          <button (click)="mobileMenuOpen = false" class="md:hidden text-gray-400 hover:text-brand-pink"><app-icon name="x" size="24px"></app-icon></button>
        </div>
        
        <nav class="flex-1 p-6 space-y-2 overflow-y-auto custom-scrollbar">
          <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 px-2">Principal</p>
          <button (click)="switchView('dashboard')" [class.bg-brand-soft]="view() === 'dashboard'" [class.text-brand-pink]="view() === 'dashboard'" [class.text-gray-600]="view() !== 'dashboard'" [class.dark:text-gray-300]="view() !== 'dashboard'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all text-sm group">
            <app-icon name="home" size="18px" class="group-hover:scale-110 transition-transform"></app-icon> Dashboard
          </button>
          <button (click)="switchView('orders')" [class.bg-brand-soft]="view() === 'orders'" [class.text-brand-pink]="view() === 'orders'" [class.text-gray-600]="view() !== 'orders'" [class.dark:text-gray-300]="view() !== 'orders'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all text-sm group">
            <app-icon name="package" size="18px" class="group-hover:scale-110 transition-transform"></app-icon> Pedidos 
            @if(store.orders().length > 0) { <span class="ml-auto bg-red-100 text-red-500 text-[10px] px-2 py-0.5 rounded-full font-bold">{{store.orders().length}}</span> }
          </button>
          <button (click)="switchView('messages')" [class.bg-brand-soft]="view() === 'messages'" [class.text-brand-pink]="view() === 'messages'" [class.text-gray-600]="view() !== 'messages'" [class.dark:text-gray-300]="view() !== 'messages'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all text-sm group">
            <app-icon name="mail" size="18px" class="group-hover:scale-110 transition-transform"></app-icon> Mensagens
            @if(store.stockAlerts().length > 0) { <span class="ml-auto bg-orange-100 text-orange-500 text-[10px] px-2 py-0.5 rounded-full font-bold">{{store.stockAlerts().length}}</span> }
          </button>
          
          <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 mt-8 px-2">Cat√°logo</p>
          <button (click)="switchView('products')" [class.bg-brand-soft]="view() === 'products'" [class.text-brand-pink]="view() === 'products'" [class.text-gray-600]="view() !== 'products'" [class.dark:text-gray-300]="view() !== 'products'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all text-sm group">
            <app-icon name="grid" size="18px" class="group-hover:scale-110 transition-transform"></app-icon> Produtos
          </button>
          <button (click)="switchView('categories')" [class.bg-brand-soft]="view() === 'categories'" [class.text-brand-pink]="view() === 'categories'" [class.text-gray-600]="view() !== 'categories'" [class.dark:text-gray-300]="view() !== 'categories'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all text-sm group">
            <app-icon name="grid" size="18px" class="group-hover:scale-110 transition-transform"></app-icon> Categorias
          </button>
          <button (click)="switchView('banners')" [class.bg-brand-soft]="view() === 'banners'" [class.text-brand-pink]="view() === 'banners'" [class.text-gray-600]="view() !== 'banners'" [class.dark:text-gray-300]="view() !== 'banners'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all text-sm group">
            <app-icon name="star" size="18px" class="group-hover:scale-110 transition-transform"></app-icon> Banners
          </button>
          
          <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 mt-8 px-2">Site</p>
          <button (click)="switchView('settings')" [class.bg-brand-soft]="view() === 'settings'" [class.text-brand-pink]="view() === 'settings'" [class.text-gray-600]="view() !== 'settings'" [class.dark:text-gray-300]="view() !== 'settings'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all text-sm group">
            <app-icon name="menu" size="18px" class="group-hover:scale-110 transition-transform"></app-icon> Configura√ß√µes
          </button>
          <button (click)="switchView('instagram')" [class.bg-brand-soft]="view() === 'instagram'" [class.text-brand-pink]="view() === 'instagram'" [class.text-gray-600]="view() !== 'instagram'" [class.dark:text-gray-300]="view() !== 'instagram'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all text-sm group">
            <app-icon name="instagram" size="18px" class="group-hover:scale-110 transition-transform"></app-icon> Feed Instagram
          </button>
          <button (click)="switchView('notifications')" [class.bg-brand-soft]="view() === 'notifications'" [class.text-brand-pink]="view() === 'notifications'" [class.text-gray-600]="view() !== 'notifications'" [class.dark:text-gray-300]="view() !== 'notifications'" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all text-sm group">
            <app-icon name="mail" size="18px" class="group-hover:scale-110 transition-transform"></app-icon> Notifica√ß√µes Globais
          </button>
        </nav>

        <div class="p-6 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">
           <div class="flex items-center gap-3 mb-4">
             <div class="w-8 h-8 rounded-full bg-brand-dark dark:bg-black text-white flex items-center justify-center font-bold text-xs">
               {{ store.user()?.name?.charAt(0) || 'A' }}
             </div>
             <div class="flex-1 min-w-0">
               <p class="text-sm font-bold text-gray-800 dark:text-white truncate">{{ store.user()?.name }}</p>
               <p class="text-xs text-green-500 font-medium flex items-center gap-1"><span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Online</p>
             </div>
           </div>
           
           <div class="flex items-center gap-1 bg-white dark:bg-gray-700 rounded-xl p-1.5 border border-gray-200 dark:border-gray-600 mb-3 shadow-sm">
             <button (click)="store.setMode('visual')" class="flex-1 py-2.5 rounded-lg text-[10px] font-black transition-all text-center flex items-center justify-center gap-1" [ngClass]="{'bg-brand-soft text-brand-pink shadow-sm': store.mode() === 'visual', 'text-gray-400 hover:text-gray-600 dark:text-gray-400': store.mode() !== 'visual'}">üé≠ Visual</button>
             <button (click)="store.setMode('real')" class="flex-1 py-2.5 rounded-lg text-[10px] font-black transition-all text-center flex items-center justify-center gap-1" [ngClass]="{'bg-green-100 text-green-600 shadow-sm': store.mode() === 'real', 'text-gray-400 hover:text-gray-600 dark:text-gray-400': store.mode() !== 'real'}">üöÄ Real</button>
           </div>

           <button (click)="logout()" class="w-full flex items-center justify-center gap-2 text-red-500 font-bold text-xs p-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors border border-red-100 dark:border-red-900/30 bg-white dark:bg-gray-700 mt-2">
             <app-icon name="log-out" size="14px"></app-icon> Sair do Sistema
           </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 md:ml-72 p-4 md:p-8 overflow-y-auto">
        
        <!-- Mobile Header -->
        <div class="md:hidden flex items-center justify-between mb-6 sticky top-0 z-40 bg-gray-100/90 dark:bg-gray-900/90 backdrop-blur pb-2">
           <div class="flex items-center gap-3">
             <button (click)="mobileMenuOpen = true" class="p-2.5 bg-white dark:bg-brand-darksurface rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 text-brand-dark dark:text-white">
               <app-icon name="menu" size="24px"></app-icon>
             </button>
             <h2 class="font-black text-xl text-gray-800 dark:text-white">Painel</h2>
           </div>
        </div>

        @if (view() === 'dashboard') {
          <div class="animate-fade-in space-y-8">
             <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
               <div>
                 <h2 class="text-3xl font-black text-gray-800 dark:text-white">Dashboard</h2>
                 <p class="text-sm text-gray-500 dark:text-gray-400 font-medium" *ngIf="store.mode() === 'visual'">‚ö†Ô∏è Modo Visual: Dados fict√≠cios de exemplo.</p>
                 <p class="text-sm text-green-600 font-medium" *ngIf="store.mode() === 'real'">‚úÖ Modo Produ√ß√£o: Dados reais da loja.</p>
               </div>
               <div class="text-sm text-gray-500 dark:text-gray-400 font-medium bg-white dark:bg-brand-darksurface px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm self-start">
                 üìÖ {{ todayStr }}
               </div>
             </div>
             <!-- Stats Grid -->
             <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
               <div class="bg-gradient-to-br from-brand-pink to-pink-600 p-6 rounded-3xl shadow-lg text-white relative overflow-hidden group">
                 <div class="absolute right-0 top-0 opacity-10 transform translate-x-1/3 -translate-y-1/3 transition-transform group-hover:scale-110">
                   <app-icon name="dollar-sign" size="120px"></app-icon>
                 </div>
                 <div class="relative z-10">
                   <p class="text-pink-100 text-xs font-bold uppercase mb-1">Vendas Totais</p>
                   <h3 class="text-3xl font-black">R$ {{ store.dashboardStats().sales.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</h3>
                 </div>
               </div>
               <div class="bg-white dark:bg-brand-darksurface p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                 <div class="flex justify-between items-start mb-4">
                   <div class="p-3 bg-brand-soft dark:bg-brand-pink/20 rounded-2xl text-brand-pink"><app-icon name="shopping-bag" size="24px"></app-icon></div>
                 </div>
                 <p class="text-gray-400 text-xs font-bold uppercase">Pedidos</p>
                 <h3 class="text-3xl font-black text-brand-dark dark:text-white">{{ store.dashboardStats().orders }}</h3>
               </div>
               <div class="bg-white dark:bg-brand-darksurface p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                 <div class="flex justify-between items-start mb-4">
                   <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-2xl text-yellow-500"><app-icon name="star" size="24px"></app-icon></div>
                 </div>
                 <p class="text-gray-400 text-xs font-bold uppercase">Ticket M√©dio</p>
                 <h3 class="text-3xl font-black text-brand-dark dark:text-white">
                   R$ {{ (store.dashboardStats().orders > 0 ? store.dashboardStats().sales / store.dashboardStats().orders : 0).toLocaleString('pt-BR', {minimumFractionDigits: 0, maximumFractionDigits: 0}) }}
                 </h3>
               </div>
             </div>
             <div class="bg-white dark:bg-brand-darksurface p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                <div class="flex items-center justify-between mb-6">
                  <div><h3 class="text-xl font-bold text-gray-800 dark:text-white">Vendas da Semana</h3></div>
                </div>
                <div class="relative h-64 w-full" #chartContainer></div>
             </div>
          </div>
        }

        <!-- Instagram Feed Management -->
        @if (view() === 'instagram') {
          <div class="animate-fade-in space-y-6">
             <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
               <div>
                 <h2 class="text-3xl font-black text-gray-800 dark:text-white">Feed do Instagram</h2>
                 <p class="text-sm text-gray-500">Gerencie as fotos que aparecem na se√ß√£o "Momentos M√°gicos".</p>
               </div>
             </div>

             <!-- Upload Area -->
             <div class="bg-white dark:bg-brand-darksurface p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                <h3 class="font-bold text-lg mb-4">Adicionar Nova Foto</h3>
                <div class="flex flex-col md:flex-row gap-4 items-end">
                   <app-image-upload label="Foto do Feed" [currentImage]="newInstagramImage" (imageSelected)="onInstagramImageSelected($event)" (fileSelected)="onInstagramFileSelected($event)"></app-image-upload>
                   <button (click)="addInstagramPost()" [disabled]="!newInstagramImage && !newInstagramFile" class="bg-brand-pink text-white px-6 py-3 rounded-xl font-bold hover:bg-pink-600 transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed mb-2 h-12">
                     Adicionar ao Feed
                   </button>
                </div>
             </div>

             <!-- Grid -->
             <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
               @for (post of store.instagramPosts(); track post.id) {
                 <div class="relative group aspect-square rounded-xl overflow-hidden shadow-sm">
                   <img [src]="post.image_url" class="w-full h-full object-cover">
                   <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                     <button (click)="deleteInstagramPost(post.id)" class="bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transform hover:scale-110 transition-all">
                       <app-icon name="trash" size="20px"></app-icon>
                     </button>
                   </div>
                 </div>
               }
             </div>
          </div>
        }

        <!-- Other Views (Simplified for Brevity - Keeping Logic Intact) -->
        @if (view() === 'orders') {
          <!-- Order Table Implementation -->
          <div class="animate-fade-in space-y-6">
             <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
               <div><h2 class="text-3xl font-black text-gray-800 dark:text-white">Gest√£o de Pedidos</h2></div>
               <button (click)="exportOrdersToCSV()" class="bg-green-500 text-white px-6 py-2.5 rounded-xl font-bold text-sm hover:bg-green-600 transition-all flex items-center gap-2 shadow-lg hover:shadow-xl"><span class="text-lg">üìä</span> Exportar Relat√≥rio</button>
             </div>
             <div class="bg-white dark:bg-brand-darksurface rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
               <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                  <thead class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800">
                    <tr><th class="px-6 py-4">ID</th><th class="px-6 py-4">Cliente</th><th class="px-6 py-4">Total</th><th class="px-6 py-4">Status</th><th class="px-6 py-4 text-center">A√ß√µes</th></tr>
                  </thead>
                  <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                    @for (order of store.orders(); track order.id) {
                      <tr class="bg-white dark:bg-brand-darksurface hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                        <td class="px-6 py-4 font-bold">#{{ order.id }}</td>
                        <td class="px-6 py-4"><p class="font-bold text-gray-800 dark:text-white">{{ order.customerName }}</p></td>
                        <td class="px-6 py-4 font-bold text-brand-dark dark:text-white">R$ {{ order.total.toFixed(2) }}</td>
                        <td class="px-6 py-4"><span class="px-3 py-1 rounded-full text-xs font-bold uppercase inline-block" [ngClass]="{'bg-yellow-100 text-yellow-700': order.status === 'pending', 'bg-green-100 text-green-700': order.status === 'paid' || order.status === 'delivered', 'bg-blue-100 text-blue-700': order.status === 'shipped', 'bg-red-100 text-red-700': order.status === 'cancelled'}">{{ getStatusLabel(order.status) }}</span></td>
                        <td class="px-6 py-4 text-center flex items-center justify-center gap-2">
                           <button (click)="openOrderDetails(order)" class="bg-brand-soft dark:bg-brand-pink/20 text-brand-pink p-2 rounded-lg hover:bg-brand-pink hover:text-white transition-colors" title="Ver Detalhes"><span class="text-lg">üëÅÔ∏è</span></button>
                           <select (change)="updateOrderStatus(order.id, $event)" class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-700 dark:text-white text-xs rounded-lg p-2 font-bold w-32"><option value="" disabled selected>Status</option><option value="pending">üü° Pendente</option><option value="paid">üü¢ Pago</option><option value="shipped">üîµ Enviado</option><option value="delivered">‚úÖ Entregue</option><option value="cancelled">üî¥ Cancelado</option></select>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
               </div>
             </div>
          </div>
        }

        @if (view() === 'products') {
          <div class="animate-fade-in space-y-6">
             <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
               <div class="flex items-center gap-4">
                 <h2 class="text-2xl md:text-3xl font-black text-gray-800 dark:text-white">Produtos</h2>
                 @if(selectedProducts().length > 0) { <button (click)="bulkDeleteProducts()" class="animate-bounce-gentle bg-red-100 text-red-600 px-4 py-2 rounded-lg font-bold text-xs items-center gap-2 hover:bg-red-200 flex transition-colors"><app-icon name="trash" size="14px"></app-icon> Excluir {{ selectedProducts().length }}</button> }
               </div>
               <button (click)="openProductModal()" class="w-full md:w-auto bg-brand-pink text-white px-6 py-3 rounded-xl font-bold hover:bg-pink-600 shadow-lg flex items-center justify-center gap-2 transition-transform hover:-translate-y-1 text-sm"><span>+</span> <span>Novo Produto</span></button>
             </div>
             <!-- Table omitted for brevity, identical to previous logic -->
             <div class="bg-white dark:bg-brand-darksurface rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
               <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                  <thead class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800">
                    <tr><th class="px-4 md:px-6 py-4 w-10"><input type="checkbox" (change)="toggleAllProducts($event)" class="rounded text-brand-pink focus:ring-brand-pink border-gray-300"></th><th class="px-4 md:px-6 py-4">Produto</th><th class="px-4 md:px-6 py-4">Pre√ßo</th><th class="px-4 md:px-6 py-4 text-center">A√ß√µes</th></tr>
                  </thead>
                  <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                    @for (product of store.products(); track product.id) {
                      <tr class="bg-white dark:bg-brand-darksurface hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors group">
                        <td class="px-4 md:px-6 py-4"><input type="checkbox" [checked]="selectedProducts().includes(product.id)" (change)="toggleProductSelection(product.id)" class="rounded text-brand-pink focus:ring-brand-pink border-gray-300"></td>
                        <td class="px-4 md:px-6 py-4"><div class="flex items-center gap-3"><img [src]="product.image" class="w-10 h-10 rounded-lg object-cover bg-gray-100 border border-gray-200"><div class="min-w-0"><p class="font-bold text-gray-800 dark:text-gray-200 line-clamp-1 text-xs md:text-sm">{{ product.name }}</p></div></div></td>
                        <td class="px-4 md:px-6 py-4 font-bold text-brand-dark dark:text-white">R$ {{ product.price.toFixed(2) }}</td>
                        <td class="px-4 md:px-6 py-4 flex justify-center gap-2"><button (click)="openProductModal(product)" class="text-blue-500 hover:text-blue-700 p-2 bg-blue-50 rounded-lg mr-1"><app-icon name="edit" size="16px"></app-icon></button><button (click)="deleteProduct(product.id)" class="text-red-500 hover:text-red-700 p-2 bg-red-50 rounded-lg"><app-icon name="trash" size="16px"></app-icon></button></td>
                      </tr>
                    }
                  </tbody>
                </table>
               </div>
             </div>
          </div>
        }

        @if (view() === 'categories') {
          <!-- Categories view implementation (simplified for brevity) -->
          <div class="animate-fade-in space-y-6">
             <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
               <div><h2 class="text-2xl md:text-3xl font-black text-gray-800 dark:text-white">Categorias</h2></div>
               <button (click)="openCategoryModal()" class="w-full md:w-auto bg-brand-pink text-white px-6 py-3 rounded-xl font-bold hover:bg-pink-600 shadow-lg flex items-center justify-center gap-2 transition-transform hover:-translate-y-1 text-sm"><span>+</span> <span>Nova Categoria</span></button>
             </div>
             <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
               @for(cat of store.categories(); track cat.id) {
                 <div class="bg-white dark:bg-brand-darksurface rounded-3xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 flex items-center gap-4 group transition-colors relative">
                    <div class="w-20 h-20 rounded-2xl overflow-hidden bg-gray-50 dark:bg-gray-800 flex-shrink-0 relative border border-gray-100"><img [src]="cat.image" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"></div>
                    <div class="flex-1 min-w-0"><h3 class="font-bold text-gray-800 dark:text-white truncate text-lg">{{ cat.name }}</h3></div>
                    <div class="flex flex-col gap-1"><button (click)="openCategoryModal(cat)" class="p-2 text-blue-500 bg-blue-50 rounded-lg"><app-icon name="edit" size="14px"></app-icon></button><button (click)="deleteCategory(cat.id)" class="p-2 text-red-500 bg-red-50 rounded-lg"><app-icon name="trash" size="14px"></app-icon></button></div>
                 </div>
               }
             </div>
          </div>
        }

        @if (view() === 'settings') {
          <div class="animate-fade-in space-y-6 max-w-4xl mx-auto pb-20">
             <div class="flex justify-between items-center">
               <div>
                 <h2 class="text-3xl font-black text-gray-800 dark:text-white">Configura√ß√µes</h2>
                 <p class="text-sm text-gray-500">Credenciais e identidade.</p>
               </div>
               <button (click)="saveSettings()" class="bg-green-500 text-white px-8 py-3 rounded-xl font-bold hover:bg-green-600 shadow-lg transition-all flex items-center gap-2">
                 <app-icon name="check" size="20px"></app-icon> Salvar
               </button>
             </div>

             <div class="grid grid-cols-1 gap-8">
               
               <!-- Identity (Logo) -->
               <div class="bg-white dark:bg-brand-darksurface p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                  <h3 class="text-lg font-bold text-brand-pink mb-4 border-b border-gray-100 dark:border-gray-700 pb-2">Identidade Visual</h3>
                  <div class="space-y-4">
                     <app-image-upload label="Logo do Site" [currentImage]="tempSettings.logoUrl" (imageSelected)="tempSettings.logoUrl = $event"></app-image-upload>
                     <p class="text-xs text-gray-400 mt-2">A logo ser√° usada no cabe√ßalho e como √≠cone do app/navegador.</p>
                  </div>
               </div>

               <!-- Payment -->
               <div class="bg-white dark:bg-brand-darksurface p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                  <h3 class="text-lg font-bold text-brand-pink mb-4 border-b border-gray-100 dark:border-gray-700 pb-2">Pagamento (Mercado Pago)</h3>
                  <div class="space-y-4">
                     <div><label class="block text-xs font-bold text-gray-500 uppercase">Public Key</label><input type="text" [(ngModel)]="tempSettings.mercadoPagoPublicKey" class="w-full p-3 border rounded-xl"></div>
                     <div><label class="block text-xs font-bold text-gray-500 uppercase">Access Token</label><input type="password" [(ngModel)]="tempSettings.mercadoPagoAccessToken" class="w-full p-3 border rounded-xl"></div>
                  </div>
               </div>

             </div>
          </div>
        }

        @if (view() === 'notifications') {
          <div class="animate-fade-in space-y-6 max-w-6xl">
            <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
              <div>
                <h2 class="text-3xl font-black text-gray-800 dark:text-white">Notifica√ß√µes Globais</h2>
                <p class="text-sm text-gray-500">Composer completo, segmenta√ß√£o, hist√≥rico e reenvio.</p>
              </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <div class="bg-white dark:bg-brand-darksurface p-5 rounded-3xl border border-gray-100 dark:border-gray-700 shadow-sm">
                <p class="text-xs text-gray-500 uppercase font-bold">Campanhas</p>
                <p class="text-3xl font-black text-brand-dark dark:text-white">{{ notifications.stats().total }}</p>
              </div>
              <div class="bg-white dark:bg-brand-darksurface p-5 rounded-3xl border border-gray-100 dark:border-gray-700 shadow-sm">
                <p class="text-xs text-gray-500 uppercase font-bold">Conclu√≠das</p>
                <p class="text-3xl font-black text-green-600">{{ notifications.stats().completed }}</p>
              </div>
              <div class="bg-white dark:bg-brand-darksurface p-5 rounded-3xl border border-gray-100 dark:border-gray-700 shadow-sm">
                <p class="text-xs text-gray-500 uppercase font-bold">Falhas parciais</p>
                <p class="text-3xl font-black text-red-500">{{ notifications.stats().failed }}</p>
              </div>
            </div>

            <div class="bg-white dark:bg-brand-darksurface p-6 rounded-3xl border border-gray-100 dark:border-gray-700 shadow-sm space-y-4">
              <h3 class="text-xl font-bold text-gray-800 dark:text-white">Composer</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-xs font-bold text-gray-500 uppercase mb-1">T√≠tulo</label>
                  <input [(ngModel)]="notificationComposer.title" class="w-full p-3 border rounded-xl" />
                </div>
                <div>
                  <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Deeplink</label>
                  <input [(ngModel)]="notificationComposer.deeplink" class="w-full p-3 border rounded-xl" />
                </div>
                <div class="md:col-span-2">
                  <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Mensagem</label>
                  <textarea [(ngModel)]="notificationComposer.body" rows="3" class="w-full p-3 border rounded-xl"></textarea>
                </div>
                <div>
                  <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Segmento</label>
                  <select [(ngModel)]="notificationComposer.audience" class="w-full p-3 border rounded-xl">
                    @for (a of audiences; track a.value) {
                      <option [ngValue]="a.value">{{ a.label }}</option>
                    }
                  </select>
                </div>
                <div>
                  <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Categoria (opcional)</label>
                  <input [(ngModel)]="notificationComposer.category_slug" class="w-full p-3 border rounded-xl" />
                </div>
                <div>
                  <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Imagem (opcional)</label>
                  <input [(ngModel)]="notificationComposer.image_url" class="w-full p-3 border rounded-xl" />
                </div>
                <div>
                  <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Agendamento</label>
                  <input [(ngModel)]="notificationComposer.schedule_for" type="datetime-local" class="w-full p-3 border rounded-xl" />
                </div>
              </div>

              <div class="flex flex-wrap gap-3 pt-2">
                <button (click)="notificationComposer.send_now = true; sendCampaign()" class="px-5 py-3 rounded-xl bg-brand-pink text-white font-bold">Enviar agora</button>
                <button (click)="notificationComposer.send_now = false; sendCampaign()" class="px-5 py-3 rounded-xl bg-brand-dark text-white font-bold">Agendar</button>
                <input [(ngModel)]="templateName" placeholder="Nome do template" class="px-3 py-2 border rounded-xl" />
                <button (click)="saveCurrentTemplate()" class="px-5 py-3 rounded-xl bg-green-500 text-white font-bold">Salvar template</button>
              </div>
            </div>

            <div class="bg-white dark:bg-brand-darksurface p-6 rounded-3xl border border-gray-100 dark:border-gray-700 shadow-sm space-y-4">
              <h3 class="text-xl font-bold text-gray-800 dark:text-white">Templates</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                @for (t of notifications.templates(); track t.id) {
                  <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-3 flex justify-between items-center">
                    <div>
                      <p class="font-bold text-sm">{{ t.name }}</p>
                      <p class="text-xs text-gray-500">{{ t.title }}</p>
                    </div>
                    <button (click)="applyTemplate(t.id)" class="px-3 py-2 rounded-lg bg-brand-soft text-brand-pink font-bold text-xs">Usar</button>
                  </div>
                }
              </div>
            </div>

            <div class="bg-white dark:bg-brand-darksurface p-6 rounded-3xl border border-gray-100 dark:border-gray-700 shadow-sm space-y-4">
              <h3 class="text-xl font-bold text-gray-800 dark:text-white">Hist√≥rico</h3>
              <div class="overflow-x-auto">
                <table class="w-full text-sm">
                  <thead>
                    <tr class="text-left text-gray-500 uppercase text-xs">
                      <th class="py-2">T√≠tulo</th>
                      <th>Status</th>
                      <th>P√∫blico</th>
                      <th>Criado em</th>
                      <th class="text-right">A√ß√µes</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (c of notifications.campaigns(); track c.id) {
                      <tr class="border-t border-gray-100 dark:border-gray-700">
                        <td class="py-3 font-bold">{{ c.title }}</td>
                        <td>{{ c.status }}</td>
                        <td>{{ c.audience }}</td>
                        <td>{{ c.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
                        <td class="text-right space-x-2">
                          <button (click)="dispatchCampaign(c.id)" class="px-3 py-1 rounded bg-brand-pink text-white text-xs font-bold">Disparar</button>
                          <button (click)="retryCampaign(c.id)" class="px-3 py-1 rounded bg-orange-500 text-white text-xs font-bold">Reenviar falhas</button>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        }

      </main>

      <!-- All Modals (Product, Category, Banner, Order) -->
      @if (selectedOrder) { 
        <div class="fixed inset-0 z-[130] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" (click)="selectedOrder = null">
          <div class="bg-white dark:bg-brand-darksurface rounded-3xl p-6 w-full max-w-lg shadow-2xl relative animate-slide-up border border-gray-100 dark:border-gray-700" (click)="$event.stopPropagation()">
            <div class="flex justify-between items-start mb-6 border-b border-gray-100 dark:border-gray-700 pb-4">
              <h3 class="text-xl font-black text-gray-800 dark:text-white">Pedido #{{ selectedOrder.id }}</h3>
              <button (click)="selectedOrder = null" class="bg-gray-100 dark:bg-gray-800 p-2 rounded-full"><app-icon name="x" size="20px"></app-icon></button>
            </div>
            <!-- Order Details Content -->
            <div class="space-y-4 text-sm">
                <p><strong>Cliente:</strong> {{ selectedOrder.customerName }}</p>
                <p><strong>Total:</strong> R$ {{ selectedOrder.total.toFixed(2) }}</p>
                <button (click)="printShippingLabel(selectedOrder)" class="mt-4 w-full py-2 bg-blue-500 text-white rounded-xl font-bold">Imprimir Etiqueta</button>
            </div>
          </div>
        </div> 
      }

      @if (showProductModal) { <div class="fixed inset-0 z-[120] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in"><div class="bg-white dark:bg-brand-darksurface rounded-3xl p-6 w-full max-w-2xl shadow-2xl relative animate-slide-up border border-gray-100 dark:border-gray-700 max-h-[90vh] overflow-y-auto"><h3 class="text-xl font-bold text-gray-800 dark:text-white mb-6">Produto</h3><div class="space-y-5"><div class="grid grid-cols-1 md:grid-cols-2 gap-5"><div class="md:col-span-2"><label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1">Nome</label><input type="text" [(ngModel)]="newProduct.name" class="w-full p-3 border rounded-xl"></div><div><label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1">Pre√ßo</label><input type="number" [(ngModel)]="newProduct.price" class="w-full p-3 border rounded-xl"></div></div><div class="flex gap-3 mt-8 pt-6 border-t border-gray-100 dark:border-gray-700"><button (click)="showProductModal = false" class="flex-1 py-3 font-bold rounded-xl bg-gray-100">Cancelar</button><button (click)="saveProduct()" class="flex-1 py-3 bg-brand-pink text-white font-bold rounded-xl">Salvar</button></div></div></div></div> }
      @if (showCategoryModal) { <div class="fixed inset-0 z-[120] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in"><div class="bg-white dark:bg-brand-darksurface rounded-3xl p-6 w-full max-w-md shadow-2xl relative animate-slide-up border border-gray-100 dark:border-gray-700"><h3 class="text-xl font-bold text-gray-800 dark:text-white mb-6">Categoria</h3><div class="space-y-4"><div><label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1">Nome</label><input type="text" [(ngModel)]="newCategory.name" class="w-full p-3 border rounded-xl"></div><app-image-upload [currentImage]="newCategory.image" (imageSelected)="onCategoryImageSelected($event)" (fileSelected)="onCategoryFileSelected($event)"></app-image-upload></div><div class="flex gap-3 mt-8"><button (click)="showCategoryModal = false" class="flex-1 py-3 font-bold rounded-xl bg-gray-100">Cancelar</button><button (click)="saveCategory()" class="flex-1 py-3 bg-brand-pink text-white font-bold rounded-xl">Salvar</button></div></div></div> }
      @if (showBannerModal) { <div class="fixed inset-0 z-[120] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in"><div class="bg-white dark:bg-brand-darksurface rounded-3xl p-6 w-full max-w-lg shadow-2xl relative animate-slide-up border border-gray-100 dark:border-gray-700 max-h-[90vh] overflow-y-auto"><h3 class="text-xl font-bold text-gray-800 dark:text-white mb-6">Banner</h3><div class="space-y-4"><div><label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1">T√≠tulo</label><input type="text" [(ngModel)]="newBanner.title" class="w-full p-3 border rounded-xl"></div><app-image-upload [currentImage]="newBanner.image!" (imageSelected)="onBannerImageSelected($event)" (fileSelected)="onBannerFileSelected($event)"></app-image-upload></div><div class="flex gap-3 mt-8"><button (click)="showBannerModal = false" class="flex-1 py-3 font-bold rounded-xl bg-gray-100">Cancelar</button><button (click)="saveBanner()" class="flex-1 py-3 bg-brand-pink text-white font-bold rounded-xl">Salvar</button></div></div></div> }

    </div>
